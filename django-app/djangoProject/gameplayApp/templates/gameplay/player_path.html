{% extends 'gameplay/base.html' %}

{% block title %}Player Paths - {{ story.title }}{% endblock %}

{% block content %}
<h2>ğŸ“Š Player Journey: {{ story.title }}</h2>

<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 40px;">
    <h1 style="font-size: 3em; margin: 0; color: white;">{{ total_plays }}</h1>
    <p style="font-size: 1.2em;">Total Plays</p>
</div>

<div class="card">
    <h3>ğŸ Ending Distribution</h3>
    <p>See which endings players reached most often</p>
</div>

{% if endings %}
    {% for ending_id, data in endings.items %}
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h4>{{ data.label }}</h4>
            <div style="text-align: right;">
                <div style="font-size: 2em; color: #667eea;">{{ data.count }}</div>
                <div>plays ({{ data.percentage }}%)</div>
            </div>
        </div>
        
        <!-- Progress bar -->
        <div style="background: #e9ecef; height: 30px; border-radius: 15px; overflow: hidden; margin-bottom: 15px;">
            <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: {% widthratio data.count total_plays 100 %}%; transition: width 0.5s;"></div>
        </div>
        
        <!-- Players who reached this ending -->
        {% if data.players %}
        <details style="margin-top: 10px;">
            <summary style="cursor: pointer; color: #667eea;"><strong>Players ({{ data.players|length }})</strong></summary>
            <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                {% for player in data.players %}
                    <span style="display: inline-block; background: #667eea; color: white; padding: 5px 10px; margin: 5px; border-radius: 15px;">
                        ğŸ‘¤ {{ player }}
                    </span>
                {% endfor %}
            </div>
        </details>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
<div class="card" style="text-align: center;">
    <p>No plays recorded yet. Be the first to play!</p>
    <a href="{% url 'play_story' story.id %}" class="btn">â–¶ï¸ Play Now</a>
</div>
{% endif %}

<div style="text-align: center; margin-top: 20px;">
    <a href="{% url 'story_detail' story.id %}" class="btn" style="background: #6c757d;">â† Back to Story</a>
    <a href="{% url 'story_tree' story.id %}" class="btn">ğŸŒ³ View Story Tree</a>
</div>
{% endblock %}